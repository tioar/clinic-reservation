<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é ç´„æˆåŠŸ</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;800;900&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="favicon.png">

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!-- CryptoJS (AES) â”€ å‰ç«¯åƒ…é®è”½ç”¨ -->
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>

<script>
/* === å¾Œç«¯ APIï¼ˆâš ï¸è«‹èˆ‡ index.html / query.html å®Œå…¨ä¸€è‡´ï¼‰ === */
const API = "https://script.google.com/macros/s/AKfycbz1jtOWBJEETvotCU2y022ow4lOlm_TauYpRMG6riUIj88_Vde5d9LHGH5cLC4HYe7X/exec";

/* === AESï¼ˆé®è”½ï¼Œä¸ç­‰æ–¼å®‰å…¨ï¼‰ === */
const AES_KEY = "A2x5fT9qR7nC1vB8mK3pZ6sD4uH0yW2j";
function aesEnc(payload, ttlMs = 10 * 60 * 1000){
  const obj = { ...payload, exp: Date.now() + ttlMs };
  return encodeURIComponent(CryptoJS.AES.encrypt(JSON.stringify(obj), AES_KEY).toString());
}
function aesDec(v){
  const txt = CryptoJS.AES.decrypt(decodeURIComponent(v), AES_KEY).toString(CryptoJS.enc.Utf8);
  const obj = JSON.parse(txt||"{}");
  if (!obj || !obj.exp || Date.now()>Number(obj.exp)) throw new Error("expired");
  return obj;
}
</script>

<style>
:root{
  --lavender:#f7f6fb; --panel:#ffffff; --text:#2a183d; --text-deep:#2a183d;
  --primary:#6236a7; --muted:#6b5f92; --soft:#efe9ff; --soft-bd:#e5dcff;

  --early-bg:#e7f7ee; --early-bd:#b8ead4; --early-tx:#065f46;
  --noon-bg:#fff3df;  --noon-bd:#ffd79a;  --noon-tx:#7a4d00;
  --night-bg:#e8f2ff; --night-bd:#cfe2ff; --night-tx:#1d4ed8;
  --appt-bg:#fde7ef;  --appt-bd:#ff99e6;  --appt-tx:#b51695;
}

html,body{width:100%;max-width:100%}
body{
  background:var(--lavender);
  font-family: "Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif;
  color:var(--text-deep);
}
.wrap{ max-width:min(880px,94vw); margin:52px auto; padding:0 16px; }
.cardx{
  background:#fff; border-radius:24px;
  padding:36px clamp(24px,4vw,44px);
  box-shadow:0 12px 28px rgba(100,61,168,.14);
  border:1px solid #efe9ff;
}

/* æ¨™é¡Œ */
.title-row{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:18px}
.title-row .icon{width:56px;height:56px;border-radius:50%;display:grid;place-items:center;background:var(--soft);color:#5b35a1}
.title-row .txt{font-size:clamp(28px,4vw,40px);font-weight:900;letter-spacing:6px}

/* å€å¡Š */
.info-block{
  border:2px dashed #ebb6e7;
  background:#fae6f0;
  border-radius:22px;
  padding:24px 18px;
}

/* å…§å®¹è¡Œ */
.bigline{font-size:clamp(20px,2.6vw,28px);font-weight:800;color:#b51695;text-align:center;margin:4px 0 12px}

/* æ¬¡è³‡è¨Š */
.subline{font-size:clamp(16px,2.2vw,20px);text-align:center;margin-bottom:6px}
.note{display:flex;align-items:center;gap:8px;justify-content:center;margin-top:8px;color:#8a66b6;font-weight:700}
.note .star{display:inline-block;width:18px;text-align:center}

/* æŒ‰éˆ•åˆ— */
.btns{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:20px}
.btnx{
  display:flex;align-items:center;justify-content:center;gap:10px;
  background:#6a3cc6;border:none;color:#fff;border-radius:18px;
  padding:16px 10px;font-weight:900;font-size:18px;
}
.btnx.ghost{background:#efe9ff;color:#4a2f82}

/* åº•éƒ¨åˆ†äº« */
.bottom{display:flex;align-items:center;gap:8px;justify-content:center;color:#5a3bb0;margin:18px 0 4px;font-weight:800}
.time{color:#7a679f;text-align:center;margin-top:6px}

@media (max-width:600px){
  .wrap{margin:28px auto}
  .btns{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="cardx">
    <div class="title-row">
      <div class="icon">âœ”</div>
      <div class="txt">é  ç´„ æˆ åŠŸ</div>
    </div>

    <div class="info-block">
      <div id="mainInfo" class="bigline">â€”</div>
      <div id="nameInfo" class="subline">â€”</div>
      <div class="note"><span class="star">ğŸ”¸</span><span>æœ€æ™šå ±åˆ°æ™‚é–“ç‚ºé–€è¨ºçµæŸå‰ä¸€å°æ™‚</span></div>
    </div>

    <div class="time" id="ts">â€”</div>

    <div class="btns mt-4">
      <a href="index.html" class="btnx">è¿”å›é ç´„é¦–é </a>
      <a href="query.html" class="btnx ghost">æŸ¥è©¢ / å–æ¶ˆé ç´„</a>
    </div>

    <div class="bottom"><span>ğŸ“</span><span>åˆ†äº«</span></div>
  </div>
</div>

<script>
/* å¾ URL å–æ†‘è­‰ä¸¦è§£å¯† */
function getParam(name){
  const u = new URL(location.href);
  return u.searchParams.get(name)||"";
}
function setText(id,txt){const el=document.getElementById(id); if(el) el.textContent=txt;}

/* æ ¼å¼åŒ– */
const pad2 = n=>String(n).padStart(2,'0');
const W = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];

/* è§£æ success å…§å®¹ */
(function boot(){
  const cipher = getParam("cipher") || sessionStorage.getItem("cipher");
  if(!cipher){
    document.body.innerHTML = '<div style="display:grid;place-items:center;height:70vh;color:#4b2c86;font-weight:800">è®€å–ä¸­è«‹ç¨ç­‰..</div>';
    return;
  }
  let obj={};
  try{obj=aesDec(cipher);}catch(_){ /* ignore */ }

  // è‹¥æ²’æä¾›å®Œæ•´å…§å®¹ï¼Œå¯å˜—è©¦å¾ API æŸ¥è©¢ï¼ˆå¯è¦–æƒ…æ³ä¿ç•™ï¼‰
  // é€™è£¡ç¤ºæ„ç›´æ¥å¾ sessionStorage å–
  try{
    const id = obj.id || sessionStorage.getItem("lastBookingId") || "";
    const rcpt = sessionStorage.getItem('rcpt:'+String(id)) || "";
    if(rcpt) obj.receipt = rcpt;
  }catch(_){}

  // çµ„ç‰ˆé¡¯ç¤º
  const dateStr = obj.date || obj.Date || "";
  const slot    = obj.slot || obj.Slot || obj.kind || "";
  const time    = obj.time || obj.Time || "";
  const doctor  = obj.doctor || obj.Doctor || "";
  const name    = obj.name || obj.Name || "";

  let wd="";
  try{ wd = "æ˜ŸæœŸ" + W[new Date(dateStr).getDay()]; }catch(_){}
  const line1 = `${dateStr}ã€€${wd}ï¼ˆ ${slot} ï¼‰ ${time} ï¼» ${doctor} ï¼½`;
  const line2 = name ? `å§“åï¼š${name}ï¼Œè™Ÿç¢¼ï¼š${obj?.number??"â€”"}è™Ÿã€‚` : "";

  setText("mainInfo", line1);
  setText("nameInfo", line2);
  setText("ts", new Date().toISOString().slice(0,19).replace("T"," "));

})();
</script>
</body>
</html>
