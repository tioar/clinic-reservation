<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>預約成功</title>

<!-- Bootstrap 只拿到元件 reset，主要樣式在本檔 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
  :root{
    --c-bg:#eef5fa;
    --c-card:#ffffff;
    --c-primary:#3b6b8a;
    --c-primary-weak:#e6edf3;
    --c-text:#1d3557;
    --c-muted:#6b7b8c;
  }
  body{
    background: var(--c-bg);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
    color: var(--c-text);
  }
  .wrap{
    max-width: 960px;
    margin: 48px auto;
    padding: 0 16px;
  }
  .card-box{
    background: var(--c-card);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    padding: 40px 28px 28px;
  }
  .heading{
    display:flex; align-items:center; justify-content:center; gap:16px; margin-bottom:6px;
  }
  .badge-ok{
    width:64px; height:64px; border-radius:16px;
    background:#e9f6ef; display:grid; place-items:center;
    box-shadow: inset 0 0 0 2px #bfe7cf;
    font-size:36px; color:#28a745;
  }
  .title{
    font-size: 42px; font-weight: 800; letter-spacing: .04em;
  }
  .subtitle{ color: var(--c-muted); margin: 6px 0 22px; }

  .info-strong{
    font-size: 1.2rem;
    font-weight: 700;
    letter-spacing: .02em;
    margin: 8px 0;
    text-align:center;
  }

  .note{
    margin: 14px auto 18px;
    color: var(--c-muted);
    display:flex; align-items:flex-start; gap:10px;
    max-width: 760px;
    line-height:1.7;
  }

  .btn-row{
    display:flex; gap:12px; margin: 18px 0 6px;
  }
  .btn-row .btn{
    flex:1; padding: 14px 12px; border-radius: 12px;
    font-weight: 700; font-size: 1.05rem;
  }
  .btn-primary{
    background: var(--c-primary); color: #fff; border:none;
  }
  .btn-secondary{
    background: var(--c-primary-weak); color: #333; border:none;
  }

  .share{
    margin-top: 10px;
    text-align: center;
    font-weight: 700;
    font-size: 1.05rem;
  }
  .share a{
    color: var(--c-text);
    text-decoration: underline;
    cursor: pointer;
  }

  .ts{
    text-align:center;
    margin-top: 8px;
    color:#8a96a3;
    font-size:.95rem;
  }

  /* 讀取中 */
  .loader{
    text-align:center;
    color: var(--c-muted);
    margin: 22px 0 8px;
    font-size: 1.05rem;
    min-height: 1.6em;
  }
  .dots::after{
    content:"";
    display:inline-block;
    width: 1.5em;
    text-align:left;
    animation: dots 1.2s steps(3,end) infinite;
  }
  @keyframes dots {
    0%{content:"";}
    33%{content:".";}
    66%{content:"..";}
    100%{content:"...";}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card-box">

    <div class="heading">
      <div class="badge-ok">✅</div>
      <div class="title">預約成功！</div>
    </div>
    <div class="subtitle text-center">您的預約資訊：</div>

    <!-- 資料區 -->
    <div id="slotLine" class="info-strong">　</div>
    <div id="nameLine" class="info-strong">　</div>

    <div class="note">
      <div style="font-size:20px; line-height:1">🗓️</div>
      <div>請在預約的門診時間內到場報到，過號則須等待現場安排叫名字，逾期自動取消。</div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="location.href='index.html'">返回預約首頁</button>
      <button class="btn btn-secondary" onclick="location.href='query.html'">查詢/取消預約</button>
    </div>

    <div class="share">
      <a id="shareBtn">📄 分享</a>
    </div>

    <div id="fillTs" class="ts"></div>

    <div id="loader" class="loader"><span class="dots">讀取中請稍等</span></div>
  </div>
</div>

<script>
  // 👉 你的 GAS endpoint（與 index.html 同一支）
  const API = "https://script.google.com/macros/s/AKfycbwXt0DJsqNy0agHuopjPTNmldG_c-sjG5a7sayV-ttE5OoOhTKHgr6RKsc8Sa-V0-Ug/exec";

  const slotLine = document.getElementById('slotLine');
  const nameLine = document.getElementById('nameLine');
  const fillTs   = document.getElementById('fillTs');
  const loader   = document.getElementById('loader');
  const shareBtn = document.getElementById('shareBtn');

  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  const wtxt = ['日','一','二','三','四','五','六'];

  function fmtDateToZh(dStr){
    // 期待格式 YYYY-MM-DD
    const d = new Date(dStr + 'T00:00:00');
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const wk = wtxt[d.getDay()];
    return `${yyyy}-${mm}-${dd} 星期${wk}`;
  }

  function buildShareText(data){
    const dateText = fmtDateToZh(data.date);
    const slot = data.slot || '';
    const time = data.time || '';
    const name = data.name || '';
    const num  = data.num  || '';
/*
陳萬龍診所門診預約成功！
預約資訊：
2025-08-22 星期五（午診）14:00~17:00
姓名：許火旺，號碼：12 號。
請在預約的門診時間內到場報到，過號則須等待現場安排叫名字，逾期自動取消。
*/
    return `陳萬龍診所門診預約成功！
預約資訊：
${dateText}（${slot}）${time}
姓名：${name}，號碼：${num} 號。
請在預約的門診時間內到場報到，過號則須等待現場安排叫名字，逾期自動取消。`;
  }

  async function init(){
    if(!id){
      loader.textContent = '參數有誤：沒有預約編號';
      return;
    }
    try{
      const r = await axios.get(API, { params: { action:'detail', id }});
      const data = r.data || {};

      // 主要兩行
      const dateText = fmtDateToZh(data.date);
      slotLine.textContent = `${dateText}（${data.slot||''}）　${data.time||''}`;
      nameLine.textContent = `姓名：${data.name||''}，號碼：${data.num||''} 號。`;

      // 填表時間
      fillTs.textContent = data.time || '';

      // 分享
      const shareText = buildShareText(data);
      shareBtn.onclick = async ()=>{
        if(navigator.share){
          try{
            await navigator.share({ title:'陳萬龍診所預約成功', text: shareText });
          }catch{}
        }else{
          try{
            await navigator.clipboard.writeText(shareText);
            alert('已複製分享內容！');
          }catch{
            prompt('複製以下分享內容：', shareText);
          }
        }
      };
    }catch(err){
      console.error(err);
      slotLine.textContent = '讀取失敗';
      nameLine.textContent = '';
      fillTs.textContent = '';
    }finally{
      loader.style.display = 'none';
    }
  }

  init();
</script>
</body>
</html>
