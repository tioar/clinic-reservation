<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é ç´„æˆåŠŸ</title>

<!-- Bootstrap åªæ‹¿åˆ°å…ƒä»¶ resetï¼Œä¸»è¦æ¨£å¼åœ¨æœ¬æª” -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
  :root{
    --c-bg:#eef5fa;
    --c-card:#ffffff;
    --c-primary:#3b6b8a;
    --c-primary-weak:#e6edf3;
    --c-text:#1d3557;
    --c-muted:#6b7b8c;
  }
  body{
    background: var(--c-bg);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
    color: var(--c-text);
  }
  .wrap{
    max-width: 960px;
    margin: 48px auto;
    padding: 0 16px;
  }
  .card-box{
    background: var(--c-card);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.08);
    padding: 40px 28px 28px;
  }
  .heading{
    display:flex; align-items:center; justify-content:center; gap:16px; margin-bottom:6px;
  }
  .badge-ok{
    width:64px; height:64px; border-radius:16px;
    background:#e9f6ef; display:grid; place-items:center;
    box-shadow: inset 0 0 0 2px #bfe7cf;
    font-size:36px; color:#28a745;
  }
  .title{
    font-size: 42px; font-weight: 800; letter-spacing: .04em;
  }
  .subtitle{ color: var(--c-muted); margin: 6px 0 22px; }

  .info-strong{
    font-size: 1.2rem;
    font-weight: 700;
    letter-spacing: .02em;
    margin: 8px 0;
    text-align:center;
  }

  .note{
    margin: 14px auto 18px;
    color: var(--c-muted);
    display:flex; align-items:flex-start; gap:10px;
    max-width: 760px;
    line-height:1.7;
  }

  .btn-row{
    display:flex; gap:12px; margin: 18px 0 6px;
  }
  .btn-row .btn{
    flex:1; padding: 14px 12px; border-radius: 12px;
    font-weight: 700; font-size: 1.05rem;
  }
  .btn-primary{
    background: var(--c-primary); color: #fff; border:none;
  }
  .btn-secondary{
    background: var(--c-primary-weak); color: #333; border:none;
  }

  .share{
    margin-top: 10px;
    text-align: center;
    font-weight: 700;
    font-size: 1.05rem;
  }
  .share a{
    color: var(--c-text);
    text-decoration: underline;
    cursor: pointer;
  }

  .ts{
    text-align:center;
    margin-top: 8px;
    color:#8a96a3;
    font-size:.95rem;
  }

  /* è®€å–ä¸­ */
  .loader{
    text-align:center;
    color: var(--c-muted);
    margin: 22px 0 8px;
    font-size: 1.05rem;
    min-height: 1.6em;
  }
  .dots::after{
    content:"";
    display:inline-block;
    width: 1.5em;
    text-align:left;
    animation: dots 1.2s steps(3,end) infinite;
  }
  @keyframes dots {
    0%{content:"";}
    33%{content:".";}
    66%{content:"..";}
    100%{content:"...";}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="card-box">

    <div class="heading">
      <div class="badge-ok">âœ…</div>
      <div class="title">é ç´„æˆåŠŸï¼</div>
    </div>
    <div class="subtitle text-center">æ‚¨çš„é ç´„è³‡è¨Šï¼š</div>

    <!-- è³‡æ–™å€ -->
    <div id="slotLine" class="info-strong">ã€€</div>
    <div id="nameLine" class="info-strong">ã€€</div>

    <div class="note">
      <div style="font-size:20px; line-height:1">ğŸ—“ï¸</div>
      <div>è«‹åœ¨é ç´„çš„é–€è¨ºæ™‚é–“å…§åˆ°å ´å ±åˆ°ï¼Œéè™Ÿå‰‡é ˆç­‰å¾…ç¾å ´å®‰æ’å«åå­—ï¼Œé€¾æœŸè‡ªå‹•å–æ¶ˆã€‚</div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="location.href='index.html'">è¿”å›é ç´„é¦–é </button>
      <button class="btn btn-secondary" onclick="location.href='query.html'">æŸ¥è©¢/å–æ¶ˆé ç´„</button>
    </div>

    <div class="share">
      <a id="shareBtn">ğŸ“„ åˆ†äº«</a>
    </div>

    <div id="fillTs" class="ts"></div>

    <div id="loader" class="loader"><span class="dots">è®€å–ä¸­è«‹ç¨ç­‰</span></div>
  </div>
</div>

<script>
  // ğŸ‘‰ ä½ çš„ GAS endpointï¼ˆèˆ‡ index.html åŒä¸€æ”¯ï¼‰
  const API = "https://script.google.com/macros/s/AKfycbwXt0DJsqNy0agHuopjPTNmldG_c-sjG5a7sayV-ttE5OoOhTKHgr6RKsc8Sa-V0-Ug/exec";

  const slotLine = document.getElementById('slotLine');
  const nameLine = document.getElementById('nameLine');
  const fillTs   = document.getElementById('fillTs');
  const loader   = document.getElementById('loader');
  const shareBtn = document.getElementById('shareBtn');

  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  const wtxt = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];

  function fmtDateToZh(dStr){
    // æœŸå¾…æ ¼å¼ YYYY-MM-DD
    const d = new Date(dStr + 'T00:00:00');
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const wk = wtxt[d.getDay()];
    return `${yyyy}-${mm}-${dd} æ˜ŸæœŸ${wk}`;
  }

  function buildShareText(data){
    const dateText = fmtDateToZh(data.date);
    const slot = data.slot || '';
    const time = data.time || '';
    const name = data.name || '';
    const num  = data.num  || '';
/*
é™³è¬é¾è¨ºæ‰€é–€è¨ºé ç´„æˆåŠŸï¼
é ç´„è³‡è¨Šï¼š
2025-08-22 æ˜ŸæœŸäº”ï¼ˆåˆè¨ºï¼‰14:00~17:00
å§“åï¼šè¨±ç«æ—ºï¼Œè™Ÿç¢¼ï¼š12 è™Ÿã€‚
è«‹åœ¨é ç´„çš„é–€è¨ºæ™‚é–“å…§åˆ°å ´å ±åˆ°ï¼Œéè™Ÿå‰‡é ˆç­‰å¾…ç¾å ´å®‰æ’å«åå­—ï¼Œé€¾æœŸè‡ªå‹•å–æ¶ˆã€‚
*/
    return `é™³è¬é¾è¨ºæ‰€é–€è¨ºé ç´„æˆåŠŸï¼
é ç´„è³‡è¨Šï¼š
${dateText}ï¼ˆ${slot}ï¼‰${time}
å§“åï¼š${name}ï¼Œè™Ÿç¢¼ï¼š${num} è™Ÿã€‚
è«‹åœ¨é ç´„çš„é–€è¨ºæ™‚é–“å…§åˆ°å ´å ±åˆ°ï¼Œéè™Ÿå‰‡é ˆç­‰å¾…ç¾å ´å®‰æ’å«åå­—ï¼Œé€¾æœŸè‡ªå‹•å–æ¶ˆã€‚`;
  }

  async function init(){
    if(!id){
      loader.textContent = 'åƒæ•¸æœ‰èª¤ï¼šæ²’æœ‰é ç´„ç·¨è™Ÿ';
      return;
    }
    try{
      const r = await axios.get(API, { params: { action:'detail', id }});
      const data = r.data || {};

      // ä¸»è¦å…©è¡Œ
      const dateText = fmtDateToZh(data.date);
      slotLine.textContent = `${dateText}ï¼ˆ${data.slot||''}ï¼‰ã€€${data.time||''}`;
      nameLine.textContent = `å§“åï¼š${data.name||''}ï¼Œè™Ÿç¢¼ï¼š${data.num||''} è™Ÿã€‚`;

      // å¡«è¡¨æ™‚é–“
      fillTs.textContent = data.time || '';

      // åˆ†äº«
      const shareText = buildShareText(data);
      shareBtn.onclick = async ()=>{
        if(navigator.share){
          try{
            await navigator.share({ title:'é™³è¬é¾è¨ºæ‰€é ç´„æˆåŠŸ', text: shareText });
          }catch{}
        }else{
          try{
            await navigator.clipboard.writeText(shareText);
            alert('å·²è¤‡è£½åˆ†äº«å…§å®¹ï¼');
          }catch{
            prompt('è¤‡è£½ä»¥ä¸‹åˆ†äº«å…§å®¹ï¼š', shareText);
          }
        }
      };
    }catch(err){
      console.error(err);
      slotLine.textContent = 'è®€å–å¤±æ•—';
      nameLine.textContent = '';
      fillTs.textContent = '';
    }finally{
      loader.style.display = 'none';
    }
  }

  init();
</script>
</body>
</html>
