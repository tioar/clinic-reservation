<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>陳萬龍診所叫號系統</title>
<style>
/* ====== 基本套用你的 CSS 變數 ====== */
:root {
  --main:#3e6d8e;
  --hover:#335a75;
  --card-bg:#ffffff;
  --page-bg:#eef3f7;
  --line:#e7e9ee;
  --danger:#dc3545;
  --danger-hover:#b02a37;
}
html,body{
  background:var(--page-bg);
  font-family:"Noto Sans TC", "Microsoft JhengHei", sans-serif;
  color:#2e2e3a;
  margin:0;
  padding:20px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
.card{
  margin:0 auto;
  padding:32px;
  border-radius:28px;
  background:var(--card-bg);
  max-width:600px;
  box-shadow:0 12px 32px rgba(18,38,63,.08);
  text-align:center;
}
h1{ color:var(--main); font-weight:700; margin-bottom:24px; }

/* 翻頁數字卡片 */
.number-card{
  display:flex;
  justify-content:center;
  gap:16px;
  margin-bottom:20px;
}
.digit{
  width:80px;
  height:100px;
  background:#fff;
  color:var(--danger);
  font-size:72px;
  font-weight:700;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
}
.digit.flip .top, .digit.flip .bottom{
  transition: transform 0.5s ease-in-out;
}
.digit .top, .digit .bottom{
  position:absolute;
  left:0; right:0;
  height:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  backface-visibility:hidden;
}
.digit .top{ top:0; border-bottom:1px solid #ccc; }
.digit .bottom{ bottom:0; transform:rotateX(180deg); }

/* 跑馬燈公告 */
.marquee{
  margin:20px auto;
  padding:10px;
  background:var(--main);
  color:#fff;
  border-radius:12px;
  width:90%;
  overflow:hidden;
  white-space:nowrap;
}
.marquee span{
  display:inline-block;
  padding-left:100%;
  animation:marquee 12s linear infinite;
}
@keyframes marquee{0%{transform:translateX(0);}100%{transform:translateX(-100%);}}

/* 按鈕 */
.btn{
  display:inline-block;
  margin:10px 10px 0 10px;
  padding:12px 28px;
  border-radius:999px;
  background:var(--main);
  color:#fff;
  font-weight:700;
  font-size:16px;
  text-decoration:none;
  cursor:pointer;
  border:none;
}
.btn:hover{ background:var(--hover); }

/* 注意事項 */
.note-box{
  margin:20px auto;
  padding:16px;
  background:#d9edf7;
  color:#2e3b4e;
  border-radius:16px;
  font-size:16px;
  line-height:1.5;
}

/* 門診表 */
.schedule{
  margin-top:20px;
  max-width:90%;
  border-radius:16px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
</style>
</head>
<body>

<div class="card">
  <h1>陳萬龍診所叫號系統</h1>

  <div id="number" class="number-card">
    <div class="digit">0</div>
    <div class="digit">0</div>
    <div class="digit">0</div>
  </div>

  <div class="marquee">
    <span>公告：此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。｜謝謝您的配合</span>
  </div>

  <div>
    <button class="btn" id="voiceBtn">開啟語音提醒</button>
    <a href="https://tioar.github.io/clinic-reservation/index.html" target="_blank" class="btn">線上預約</a>
  </div>

  <div class="note-box">
    此號碼僅供參考，實際叫號以現場為主，每位患者預估三到五分鐘，請提前到場等候以免過號。
  </div>

  <img src="images/schedule.png" alt="門診時間表" class="schedule">
</div>

<script>
let lastNumber='000';
let canSpeak=false;

// 開啟語音提醒
document.getElementById('voiceBtn').addEventListener('click',()=>{
  canSpeak=true;
  alert('語音提醒已啟用，未來號碼更新會自動播報！');
});

// 翻頁動畫
function animateDigit(digitElem,newNum){
  if(digitElem.innerText===newNum) return;
  const top=document.createElement('div');
  top.className='top';
  top.innerText=digitElem.innerText;
  const bottom=document.createElement('div');
  bottom.className='bottom';
  bottom.innerText=newNum;
  digitElem.innerText='';
  digitElem.appendChild(top);
  digitElem.appendChild(bottom);
  setTimeout(()=>{
    top.style.transform='rotateX(-180deg)';
    bottom.style.transform='rotateX(0deg)';
  },50);
  setTimeout(()=>{ digitElem.innerText=newNum; },550);
}

// 更新整個號碼
function updateNumber(newNumber){
  const digits=document.querySelectorAll('#number .digit');
  newNumber.split('').forEach((n,i)=>{
    animateDigit(digits[i],n);
  });
}

// 格式化數字
function formatNumber(num){ return String(num).padStart(3,'0'); }

// 語音播報
function speakNumber(number){
  if(canSpeak && 'speechSynthesis' in window){
    const msg=new SpeechSynthesisUtterance(number+'號請進診間');
    window.speechSynthesis.speak(msg);
  }
}

// 抓號碼
async function fetchNumber(){
  try{
    const res=await fetch("https://script.google.com/macros/s/AKfycbxmehGXGH_bPOD9tlOTibLzRuH35Jy3hiShjPlag2rSzpm-9c9VKTduRbc4Bjf6nifd/exec");
    const data=await res.json();
    const currentNumber=formatNumber(data.number);
    if(currentNumber!==lastNumber){
      updateNumber(currentNumber);
      speakNumber(currentNumber);
      lastNumber=currentNumber;
    }
  }catch(e){console.error('抓號碼失敗',e);}
}

setInterval(fetchNumber,5000);
fetchNumber();
</script>

</body>
</html>
