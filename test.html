<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é™³è¬é¾è¨ºæ‰€é–€è¨ºç·šä¸Šé ç´„</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;800;900&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

<style>
  :root{ --primary:#6236a7; --bg:#f7f6fb; --card:#fff; --line:#ebe6fb; --muted:#6b5f92; }

  *{box-sizing:border-box}
  html,body{width:100%;max-width:100%}
  body{margin:0;background:var(--bg);color:#1f1330;font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,sans-serif}
  .wrap{max-width:960px;margin:16px auto;padding:12px}

  /* ======= Page Headerï¼ˆæ¯”ç…§ index æ¨£å¼ï¼‰ ======= */
  .page-head{display:flex;align-items:center;gap:14px;margin:6px 8px 14px}
  .page-head .logo{
    width:60px;height:60px;border-radius:50%;
    display:grid;place-items:center;
    background:var(--primary);color:#fff;font-weight:900;font-size:32px;
    box-shadow:0 8px 18px rgba(98,54,167,.18);
  }
  .page-head h1{margin:0;font-weight:900;font-size:clamp(1.4rem,2.2vw,2rem);color:#2a183d}

  /* ======= Card ======= */
  .cardish{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 10px 24px rgba(98,54,167,.1)}
  .section{padding:14px}

  /* ======= Calendar ======= */
  .cal-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line)}
  .cal-title{font-weight:900;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
  .loader{color:#6b5f92;font-size:.95rem;white-space:nowrap;min-width:6.5em}
  .nav{display:flex;gap:8px}
  .nav button{border:none;background:var(--primary);color:#fff;border-radius:12px;padding:.35rem .7rem;font-weight:900;cursor:pointer}
  .nav button[disabled]{opacity:.45;cursor:not-allowed}

  .rule-bar{padding:10px 12px;border-bottom:1px solid var(--line);display:flex;justify-content:flex-start}
  .rule-btn{border:none;background:#efe9ff;color:#4a2f82;font-weight:800;border-radius:999px;padding:.35rem .8rem}

  .grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:8px;padding:10px}
  .wday{font-size:.9rem;color:var(--muted);text-align:center;font-weight:800}
  .day{border:1px solid #e6e8f0;border-radius:14px;min-height:74px;padding:8px;display:flex;flex-direction:column;gap:6px;background:#fff;transition:.12s;overflow:hidden}
  .day .d{font-weight:900;color:#24163a}
  .day .meta{margin-top:auto;display:flex;flex-wrap:wrap;gap:6px}
  .day.clickable{cursor:pointer}
  .day.clickable:hover{box-shadow:0 0 0 2px #d7caf6}
  .day.disabled{background:#f1f2f6;color:#8b90a3;border-color:#e5e7eb;opacity:.85;pointer-events:none}

  .pill{
    display:inline-flex; align-items:center; justify-content:center;
    gap:.3rem; border:1px solid #e3e6ee; border-radius:999px;
    padding:.18rem .6rem; font-weight:900;
    font-size:clamp(.76rem,.9vw,.92rem); line-height:1.1;
    white-space:nowrap; min-width:4.2em;
  }
  .pill .lbl{white-space:nowrap}
  .pill .remain{white-space:nowrap}
  .pill.early{background:#e7f7ee;color:#065f46;border-color:#b8ead4}
  .pill.noon {background:#fff3df;color:#7a4d00;border-color:#ffd79a}
  .pill.night{background:#e8f2ff;color:#1d4ed8;border-color:#cfe2ff}
  .pill.appt {background:#fde7ef;color:#b51695;border-color:#ff99e6}

  #dayPanel{display:none}
  #dayPanel .head{font-weight:900;margin:6px 0 10px}
  .slot-grid{display:grid;grid-template-columns:1fr;gap:10px}
  .tile{display:flex;align-items:center;gap:10px;border:1px solid #e0e4ef;border-radius:14px;padding:12px;background:#fff;cursor:pointer;transition:.12s}
  .tile:hover{box-shadow:0 0 0 2px #e6dbff}
  .tile .remain{margin-left:auto;font-weight:900;white-space:nowrap}
  .tile .doc{color:#6b5f92;font-weight:800}
  .tile.selected{background:#f3edff;box-shadow:0 0 0 2px #cdbbff}

  .picked{display:none;margin-top:8px;color:#3b2c5f}
  .picked b{color:#000}
  .picked .hl{color:#6236a7;font-weight:900}

  /* ======= Form ======= */
  .form-grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  .form-label-strong{font-weight:700;margin-bottom:6px}
  .form-input{width:100%;padding:.6rem .7rem;border:1px solid #ced2db;border-radius:12px;font-size:1rem;line-height:1.25;height:auto}
  .btn-main{background:var(--primary);color:#fff;border:none;border-radius:14px;padding:.7rem 1.1rem;font-weight:900}
  .btn-ghost{background:#fff;border:1px solid #d7dbe5;border-radius:14px;padding:.7rem 1.1rem;font-weight:900;color:#3a3f47}
  .agree{display:flex;align-items:center;gap:.5rem;flex-wrap:nowrap}
  .agree a{color:#6236a7;text-decoration:underline}

  /* ======= æ–¹æ¡ˆ Aï¼šæ‰‹æ©Ÿï¼ˆå…©æ¬„ç›´æ’ï¼Œå–æ¶ˆè£åˆ‡ï¼‰ ======= */
  @media (max-width:600px){
    .wrap{padding:8px}
    .page-head{margin:4px 4px 12px}
    .page-head .logo{width:52px;height:52px;font-size:28px}

    .grid{gap:4px;padding:8px}
    .day{min-height:auto;border-radius:12px;padding:6px}
    .day .d{font-size:.95rem}
    .day .meta{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:4px; max-height:none; overflow:visible;
    }
    .pill{display:block;width:100%;text-align:center;padding:.12rem .3rem;font-size:.74rem;line-height:1.15;min-width:auto}
    .pill .remain{display:none}

    .tile{padding:10px;border-radius:12px}
    .form-grid{grid-template-columns:1fr 1fr}
    /* èª¿å°åŸç”Ÿ date input çš„ã€Œè† å›Šã€å°ºå¯¸ï¼Œé¿å…æº¢å‡º */
    input.form-input[type="date"]{
      font-size: 15px;          /* ç¨å¾®ç¸®å°å­—ç´š */
      padding: .48rem .6rem;    /* é™ä½å…§è· */
      line-height: 1.1;         /* é™ä½è¡Œé«˜è®“é«˜åº¦è·Ÿè‘—ç¸® */
      height: auto;
    }
    /* iOS WebKit å…§éƒ¨å€å¡Šä¹Ÿè·Ÿè‘—ç¸® */
    input[type="date"]::-webkit-datetime-edit{ padding:0.2em 0.3em; }
    input[type="date"]::-webkit-datetime-edit-fields-wrapper{ padding:0; }
  }
  @media (max-width:360px){
    .day .meta{grid-template-columns:1fr}
  }

  /* è¦å‰‡å½ˆçª—å…§çš„å°è† å›Š */
  .chip{display:inline-block;padding:.25rem .6rem;border-radius:999px;border:1px solid #e6e8f0;background:#fff}
  .chip-strong{background:#f3f0ff;color:#4a2f82;border-color:#e4ddff;font-weight:800}
  .chip-range{background:#f8fafc;color:#334155}
</style>
</head>
<body>
<div class="wrap">
  <!-- é é¦–ï¼šæ¯”ç…§ index -->
  <div class="page-head">
    <div class="logo">ï¼‹</div>
    <h1>é™³è¬é¾è¨ºæ‰€é–€è¨ºç·šä¸Šé ç´„</h1>
  </div>

  <div class="cardish">
    <div class="cal-head">
      <div class="cal-title">
        <span id="calTitle">â€”</span>
        <span id="calLoader" class="loader" style="display:none">è¼‰å…¥ä¸­â€¦</span>
      </div>
      <div class="nav">
        <button id="btnPrev" aria-label="ä¸Šä¸€æœˆ">â†</button>
        <button id="btnNext" aria-label="ä¸‹ä¸€æœˆ">â†’</button>
      </div>
    </div>

    <!-- è¦å‰‡æŒ‰éˆ• -->
    <div class="rule-bar">
      <button class="rule-btn" id="openRules">ğŸ”º é–‹æ”¾é–€è¨ºé ç´„æ—¥æœŸè¦å‰‡</button>
    </div>

    <div class="grid" id="whead"></div>
    <div class="grid" id="days"></div>
    <div class="section" id="dayPanel"></div>
    <div class="section picked" id="picked"></div>
  </div>

  <!-- è¡¨å–® -->
  <div class="cardish section mt-3">
    <input type="hidden" id="date" />
    <input type="hidden" id="slot" />
    <div class="form-grid">
      <div>
        <div class="form-label-strong">å§“å *</div>
        <input id="name" type="text" class="form-input"/>
      </div>
      <div>
        <div class="form-label-strong">å‡ºç”Ÿå¹´æœˆæ—¥ *</div>
        <input id="birthday" type="date" class="form-input"/>
      </div>
      <div>
        <div class="form-label-strong">èº«åˆ†è­‰å­—è™Ÿ *</div>
        <input id="idnum" type="text" maxlength="10" class="form-input" placeholder="A123456789"/>
      </div>
      <div>
        <div class="form-label-strong">é€£çµ¡é›»è©± *</div>
        <input id="phone" type="text" maxlength="10" inputmode="numeric" class="form-input" placeholder="0958xxxxxx"/>
      </div>
    </div>

    <div class="mt-2">
      <label class="agree">
        <input id="agree" type="checkbox"/>
        <span>æˆ‘å·²é–±è®€ä¸¦åŒæ„ <a href="#" id="showNotice">é ç´„é ˆçŸ¥</a></span>
      </label>
    </div>

    <div class="d-grid gap-2 mt-3">
      <button id="submitBtn" class="btn-main">é€å‡ºé ç´„</button>
      <a href="query.html" class="btn-ghost text-center text-decoration-none">æŸ¥è©¢ï¼å–æ¶ˆé ç´„</a>
    </div>
  </div>
</div>

<!-- è¦å‰‡ Modal -->
<div class="modal fade" id="rulesModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="border-radius:18px">
      <div class="modal-header" style="background:#f3edff;border-bottom:1px solid #e9e0ff;border-top-left-radius:18px;border-top-right-radius:18px">
        <h5 class="modal-title" style="font-weight:900;color:#4a2f82">ğŸ”º é–‹æ”¾é–€è¨ºé ç´„æ—¥æœŸå°ç…§</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" style="background:#f6f3ff">
        <div class="p-2 rounded-3" style="background:#efeaff;border:1px solid #e5dcff">
          <div class="row gy-2">
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±ä¸€</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» é€±å›› ~ ä¸‹ä¸‹é€±ä¸€ ï¼½</span></div>
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±äºŒ</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» é€±äº” ~ ä¸‹ä¸‹é€±äºŒ ï¼½</span></div>
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±ä¸‰</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» é€±å…­ ~ ä¸‹ä¸‹é€±ä¸‰ ï¼½</span></div>
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±å››</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» ä¸‹é€±ä¸€ ~ ä¸‹ä¸‹é€±å›› ï¼½</span></div>
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±äº”</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» ä¸‹é€±äºŒ ~ ä¸‹ä¸‹é€±äº” ï¼½</span></div>
            <div class="col-12 col-md-6"><span class="chip chip-strong">é€±å…­</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» ä¸‹é€±äºŒ ~ ä¸‹ä¸‹é€±å…­ ï¼½</span></div>
            <div class="col-12"><span class="chip chip-strong">é€±æ—¥</span><span class="mx-1">å¯é ç´„ â†’</span><span class="chip chip-range">ï¼» ä¸‹é€±ä¸‰ ~ ä¸‹ä¸‹é€±æ—¥ ï¼½</span></div>
          </div>
        </div>
        <div class="mt-3 text-secondary" style="font-size:.95rem">
          å¦‚å°é–€è¨ºæ™‚é–“æœ‰ç–‘å•ï¼Œè«‹å°ç…§ã€Œé–€è¨ºæ™‚åˆ»è¡¨ã€èˆ‡ã€Œæœ€æ–°æ¶ˆæ¯ã€ç¢ºèªæ˜¯å¦æœ‰é–€è¨ºç•°å‹•ã€‚
        </div>
      </div>
    </div>
  </div>
</div>

<!-- é ç´„é ˆçŸ¥ Modal -->
<div class="modal fade" id="noticeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">é ç´„é ˆçŸ¥èˆ‡å€‹è³‡å‘ŠçŸ¥</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body" style="text-align:left;">
        <p>1. å€‹è³‡ç”¨é€”ï¼šåƒ…ä¾›é ç´„èˆ‡è¯ç¹«ï¼Œä¸å¦ä½œä»–ç”¨ã€‚</p>
        <p>2. å ±åˆ°æ™‚é–“ï¼šè«‹æ–¼å„æ™‚æ®µçµæŸå‰ 1 å°æ™‚å®Œæˆå ±åˆ°ï¼ˆæ—© 10:30ï¼åˆ 16:00ï¼æ™š 20:00ï¼‰ï¼Œé€¾æ™‚é‡‹å‡ºåé¡ã€‚</p>
        <p>3. å–æ¶ˆæ–¹å¼ï¼šå‰ä¸€æ—¥ç·šä¸Šè¾¦ç†ï¼›ç•¶æ—¥è«‹é›»æ´½ (03) 515-2971ã€‚</p>
        <p>4. ä¾é†«ç™‚éœ€æ±‚ï¼Œç¾å ´çœ‹è¨ºé †åºå¯èƒ½èª¿æ•´ã€‚</p>
        <p>5. å‹¾é¸åŒæ„è¡¨ç¤ºç†è§£ä¸¦æ¥å—ä¸Šè¿°å…§å®¹ã€‚</p>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== CONFIG / Utils ===== */
const API="https://script.google.com/macros/s/AKfycbz1jtOWBJEETvotCU2y022ow4lOlm_TauYpRMG6riUIj88_Vde5d9LHGH5cLC4HYe7X/exec";
const pad2=n=>String(n).padStart(2,'0');
const ymd=d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
const firstOfMonth=d=>new Date(d.getFullYear(), d.getMonth(), 1);
const endOfMonth=d=>new Date(d.getFullYear(), d.getMonth()+1, 0);
const addMonths=(d,n)=>new Date(d.getFullYear(), d.getMonth()+n, 1);
const W=['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
const fmtTitle=d=>`${d.getFullYear()}å¹´${d.getMonth()+1}æœˆä»½`;

const NOW=new Date();
let WINDOW_MIN=null,WINDOW_MAX=null;
let curMonth=firstOfMonth(NOW);

const $title=document.getElementById('calTitle');
const $loader=document.getElementById('calLoader');
const $whead=document.getElementById('whead');
const $days=document.getElementById('days');
const $prev=document.getElementById('btnPrev');
const $next=document.getElementById('btnNext');
const $panel=document.getElementById('dayPanel');
const $picked=document.getElementById('picked');
const $date=document.getElementById('date');
const $slot=document.getElementById('slot');
const $agree=document.getElementById('agree');

/* è¦å‰‡ï¼é ˆçŸ¥ */
document.getElementById('openRules').addEventListener
